---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/common/Header.astro';
import MobileMenu from '../../components/common/MobileMenu.astro';
import PageHeader from '../../components/common/PageHeader.astro';
import NewsCard from '../../components/cards/NewsCard.astro';
import NewsModal from '../../components/modals/NewsModal.astro';
import Pagination from '../../components/common/Pagination.astro';
import EmptyState from '../../components/common/EmptyState.astro';
import Footer from '../../components/common/Footer.astro';
import StaticDragonfly from '../../components/decorations/StaticDragonfly.astro';
import { getPublishedNews } from '../../utils/contentHelpers';
import type { Page, GetStaticPathsOptions } from 'astro';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allNews = await getPublishedNews();
  return paginate(allNews, { pageSize: 10 });
}

type Props = {
  page: Page<CollectionEntry<'news'>>;
};

const { page } = Astro.props;
---

<Layout
  title="Aktuality - Zdravíčko"
  description="Aktuální informace z naší dětské ordinace - důležitá oznámení, změny ordinačních hodin a další novinky"
>
  <Header activePage="aktuality" />
  <MobileMenu activePage="aktuality" />

  <main>
    <div class="relative">
      <PageHeader
        title="Aktuality"
        description="Aktuální informace z naší ordinace - důležitá oznámení, změny ordinačních hodin a novinky"
        gradient={true}
      />
      <StaticDragonfly right={12} top={18} size="150px" sizeMobile="105px" opacity={0.9} rotation={10} zIndex={1} />
      <StaticDragonfly left={8} bottom={10} size="145px" sizeMobile="100px" opacity={0.85} rotation={-12} zIndex={1} />
    </div>

    <section class="py-16 bg-white">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          {page.data.length > 0 ? (
            <>
              <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                {page.data.map((news) => (
                  <NewsCard news={news} />
                ))}
              </div>

              <Pagination page={page} baseUrl="/aktuality" />
            </>
          ) : (
            <EmptyState
              icon="mdi:newspaper-variant-outline"
              message="Momentálně nejsou k dispozici žádné aktuality"
            />
          )}
        </div>
      </div>
    </section>
  </main>

  <!-- Modals pro všechny aktuality -->
  {page.data.map((news) => (
    <NewsModal news={news} />
  ))}

  <Footer />
</Layout>
