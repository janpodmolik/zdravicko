---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/common/Header.astro';
import MobileMenu from '../../components/common/MobileMenu.astro';
import PageHeader from '../../components/common/PageHeader.astro';
import BlogCard from '../../components/cards/BlogCard.astro';
import Pagination from '../../components/common/Pagination.astro';
import EmptyState from '../../components/common/EmptyState.astro';
import Footer from '../../components/common/Footer.astro';
import StaticDragonfly from '../../components/decorations/StaticDragonfly.astro';
import { Icon } from 'astro-icon/components';
import { getPublishedBlogPosts } from '../../utils/contentHelpers';
import { contactInfo } from '../../data/contact';
import type { Page, GetStaticPathsOptions } from 'astro';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allPosts = await getPublishedBlogPosts();
  return paginate(allPosts, { pageSize: 9 });
}

type Props = {
  page: Page<CollectionEntry<'blog'>>;
};

const { page } = Astro.props;
---

<Layout title="Blog - Zdravíčko" description="Články ze života ordinace, rady pro rodiče a odborné tipy od našeho týmu. Nejen medicína, ale i osobní příběhy a zkušenosti.">
  <Header activePage="blog" />
  <MobileMenu activePage="blog" />

  <div class="relative">
    <PageHeader
      title="Blog"
      description="Příběhy ze života ordinace, rady pro rodiče a odborné tipy"
      gradient={true}
    />
    <StaticDragonfly left={12} top={14} size="155px" sizeMobile="108px" opacity={0.9} rotation={-8} zIndex={5} />
    <StaticDragonfly right={8} top={10} size="145px" sizeMobile="100px" opacity={0.85} rotation={16} zIndex={5} />
  </div>

  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-6xl mx-auto">
        {page.data.length > 0 ? (
          <>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {page.data.map((post) => <BlogCard post={post} />)}
            </div>

            <Pagination page={page} baseUrl="/blog" />
          </>
        ) : (
          <EmptyState
            icon="mdi:post-outline"
            message="Momentálně nejsou k dispozici žádné příspěvky"
          />
        )}
      </div>
    </div>
  </section>

  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Máte dotaz?</h2>
        <p class="text-lg text-gray-600 mb-6">
          Pokud máte konkrétní otázku ohledně zdraví Vašeho dítěte, neváhejte nás kontaktovat.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href={`tel:${contactInfo.phones.doctor.number}`} class="bg-[#5085c6] text-white px-8 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity inline-flex items-center justify-center gap-2">
            <Icon name="mdi:phone" class="w-5 h-5" />
            Zavolat
          </a>
          <a href="/kontakt" class="bg-white text-[#5085c6] px-8 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors border-2 border-[#5085c6]">
            Napsat email
          </a>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</Layout>
