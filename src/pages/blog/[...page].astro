---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/common/Header.astro';
import MobileMenu from '../../components/common/MobileMenu.astro';
import PageHeader from '../../components/common/PageHeader.astro';
import BlogCard from '../../components/cards/BlogCard.astro';
import Pagination from '../../components/common/Pagination.astro';
import EmptyState from '../../components/common/EmptyState.astro';
import Footer from '../../components/common/Footer.astro';
import { Icon } from 'astro-icon/components';
import type { BlogCardData } from '../../components/cards/BlogCard.astro';
import { getPublishedBlogPosts, blogEntryToCardData } from '../../utils/contentHelpers';
import { contactInfo } from '../../data/contact';
import type { Page, GetStaticPathsOptions } from 'astro';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allPosts = await getPublishedBlogPosts();
  return paginate(allPosts, { pageSize: 9 });
}

type Props = {
  page: Page<CollectionEntry<'blog'>>;
};

const { page } = Astro.props;

// Transformovat příspěvky pro BlogCard
const posts = page.data.map((entry, index) =>
  blogEntryToCardData(entry, (page.currentPage - 1) * page.size + index + 1)
);
---

<Layout title="Blog - Zdravíčko" description="Odborné články a rady pro rodiče od našeho týmu. Zdraví dětí, prevence, výživa a mnoho dalšího.">
  <Header activePage="blog" />
  <MobileMenu activePage="blog" />

  <PageHeader
    title="Blog"
    description="Odborné články a rady pro rodiče od našeho týmu"
  />

  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-6xl mx-auto">
        {page.data.length > 0 ? (
          <>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {posts.map((post: BlogCardData) => <BlogCard {...post} />)}
            </div>

            <Pagination page={page} baseUrl="/blog" />
          </>
        ) : (
          <EmptyState
            icon="mdi:post-outline"
            message="Momentálně nejsou k dispozici žádné příspěvky"
          />
        )}
      </div>
    </div>
  </section>

  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Máte dotaz?</h2>
        <p class="text-lg text-gray-600 mb-6">
          Pokud máte konkrétní otázku ohledně zdraví vašeho dítěte, neváhejte nás kontaktovat.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href={`tel:${contactInfo.phones.doctor.number}`} class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors inline-flex items-center justify-center gap-2">
            <Icon name="mdi:phone" class="w-5 h-5" />
            Zavolat
          </a>
          <a href="/kontakt" class="bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors border-2 border-blue-600">
            Napsat email
          </a>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</Layout>
