---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import MobileMenu from '../../components/MobileMenu.astro';
import BlogCard from '../../components/BlogCard.astro';
import Footer from '../../components/Footer.astro';
import { Icon } from 'astro-icon/components';
import { getCollection, type CollectionEntry } from 'astro:content';
import { formatDate } from '../../utils/dateFormat';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog', ({ data }: CollectionEntry<'blog'>) => data.published !== false);
  return blogPosts.map((post: CollectionEntry<'blog'>) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content } = await post.render();

// Související články
const allPosts = await getCollection('blog', ({ data }: CollectionEntry<'blog'>) => data.published !== false);
const relatedPosts = allPosts
  .filter((p: CollectionEntry<'blog'>) => p.slug !== post.slug)
  .slice(0, 3);
---

<Layout 
  title={`${post.data.title} - Blog | Zdravíčko`} 
  description={post.data.excerpt}
>
  <Header activePage="blog" />
  <MobileMenu activePage="blog" />

  <section class="bg-gray-50 py-4">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <nav class="flex items-center gap-2 text-sm text-gray-600">
          <a href="/" class="hover:text-blue-600 transition-colors">Domů</a>
          <Icon name="mdi:chevron-right" class="w-4 h-4" />
          <a href="/blog" class="hover:text-blue-600 transition-colors">Blog</a>
          <Icon name="mdi:chevron-right" class="w-4 h-4" />
          <span class="text-gray-900 font-medium">{post.data.title}</span>
        </nav>
      </div>
    </div>
  </section>

  <article class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <header class="mb-12">
          <div class="mb-6">
            <span class="bg-blue-100 text-blue-600 px-4 py-2 rounded-full text-sm font-semibold">
              {post.data.category}
            </span>
          </div>
          
          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
            {post.data.title}
          </h1>
          
          <div class="flex flex-wrap items-center gap-6 text-gray-600">
            <div class="flex items-center gap-2">
              <Icon name="mdi:account-circle" class="w-5 h-5" />
              <span>{post.data.author}</span>
            </div>
            <div class="flex items-center gap-2">
              <Icon name="mdi:calendar" class="w-5 h-5" />
              <time datetime={post.data.date.toISOString()}>
                {formatDate(post.data.date.toISOString())}
              </time>
            </div>
            <div class="flex items-center gap-2">
              <Icon name="mdi:clock-outline" class="w-5 h-5" />
              <span>{post.data.readTime}</span>
            </div>
          </div>
        </header>

        <div class="mb-12">
          <div class="relative h-96 bg-linear-to-br from-blue-100 to-cyan-100 rounded-2xl flex items-center justify-center">
            <Icon name="mdi:image" class="w-32 h-32 text-blue-300" />
          </div>
        </div>

        <div class="prose prose-lg max-w-none">
          <div class="
            [&>h2]:text-3xl [&>h2]:font-bold [&>h2]:text-gray-900 [&>h2]:mt-12 [&>h2]:mb-6
            [&>h3]:text-2xl [&>h3]:font-bold [&>h3]:text-gray-900 [&>h3]:mt-8 [&>h3]:mb-4
            [&>p]:text-gray-700 [&>p]:leading-relaxed [&>p]:mb-6
            [&>ul]:list-disc [&>ul]:ml-6 [&>ul]:mb-6 [&>ul]:space-y-2
            [&>li]:text-gray-700 [&>li]:leading-relaxed
            [&>strong]:text-gray-900 [&>strong]:font-semibold
          ">
            <Content />
          </div>
        </div>

        <div class="mt-12 pt-8 border-t border-gray-200">
          <div class="flex items-center justify-between">
            <span class="text-gray-600 font-medium">Sdílet článek:</span>
            <div class="flex gap-3">
              <button class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center hover:bg-blue-200 transition-colors">
                <Icon name="mdi:facebook" class="w-5 h-5" />
              </button>
              <button class="w-10 h-10 bg-sky-100 text-sky-600 rounded-full flex items-center justify-center hover:bg-sky-200 transition-colors">
                <Icon name="mdi:twitter" class="w-5 h-5" />
              </button>
              <button class="w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center hover:bg-green-200 transition-colors">
                <Icon name="mdi:whatsapp" class="w-5 h-5" />
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </article>

  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">
          Mohlo by vás zajímat
        </h2>
        
        <div class="grid md:grid-cols-3 gap-8">
          {relatedPosts.map((p: CollectionEntry<'blog'>, index: number) => (
            <BlogCard post={{
              id: index + 1,
              title: p.data.title,
              excerpt: p.data.excerpt,
              category: p.data.category,
              readTime: p.data.readTime,
              date: p.data.date.toISOString(),
              slug: p.slug,
              image: p.data.image || '/images/blog-placeholder.jpg',
              author: p.data.author,
              content: '',
            }} />
          ))}
        </div>
        
        <div class="mt-12 text-center">
          <a href="/blog" class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 font-semibold">
            <Icon name="mdi:arrow-left" class="w-5 h-5" />
            Zpět na blog
          </a>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</Layout>
