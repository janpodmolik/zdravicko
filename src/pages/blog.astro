---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import MobileMenu from '../components/MobileMenu.astro';
import PageHeader from '../components/PageHeader.astro';
import BlogCard from '../components/BlogCard.astro';
import Footer from '../components/Footer.astro';
import { Icon } from 'astro-icon/components';
import { getCollection, type CollectionEntry } from 'astro:content';
import type { BlogPost } from '../data/blogPosts';

// Získat všechny publikované příspěvky z Content Collections
const allPosts = await getCollection('blog', ({ data }: CollectionEntry<'blog'>) => {
  return data.published !== false;
});

// Seřadit podle data (nejnovější první) a namapovat na formát pro BlogCard
const posts = allPosts
  .sort((a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) => {
    return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
  })
  .map((entry: CollectionEntry<'blog'>, index: number) => ({
    id: index + 1,
    slug: entry.slug,
    title: entry.data.title,
    excerpt: entry.data.excerpt,
    category: entry.data.category,
    date: entry.data.date.toISOString(),
    readTime: entry.data.readTime,
    author: entry.data.author,
    image: entry.data.image || '/images/blog-placeholder.jpg',
    content: '',
  }));
---

<Layout title="Blog - Zdravíčko" description="Odborné články a rady pro rodiče od MUDr. Jany Novákové. Zdraví dětí, prevence, výživa a mnoho dalšího.">
  <Header activePage="blog" />
  <MobileMenu activePage="blog" />

  <PageHeader 
    title="Blog"
    description="Odborné články a rady pro rodiče od našeho týmu"
  />


  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-6xl mx-auto">
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {posts.map((post: BlogPost) => <BlogCard post={post} />)}
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Máte dotaz?</h2>
        <p class="text-lg text-gray-600 mb-6">
          Pokud máte konkrétní otázku ohledně zdraví vašeho dítěte, neváhejte nás kontaktovat.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="tel:+420731232333" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors inline-flex items-center justify-center gap-2">
            <Icon name="mdi:phone" class="w-5 h-5" />
            Zavolat
          </a>
          <a href="/#kontakt" class="bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors border-2 border-blue-600">
            Napsat email
          </a>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</Layout>
