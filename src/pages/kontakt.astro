---
import Layout from '../layouts/Layout.astro';
import Header from '../components/common/Header.astro';
import MobileMenu from '../components/common/MobileMenu.astro';
import PageHeader from '../components/common/PageHeader.astro';
import Footer from '../components/common/Footer.astro';
import ContactInfoItem from '../components/cards/ContactInfoItem.astro';
import ContactPhoneItem from '../components/cards/ContactPhoneItem.astro';
import EmergencyNotice from '../components/common/EmergencyNotice.astro';
import ContactForm from '../components/forms/ContactForm.astro';
import DirectionCard from '../components/cards/DirectionCard.astro';
import StaticDragonfly from '../components/decorations/StaticDragonfly.astro';
import { Icon } from 'astro-icon/components';
import { contactInfo } from '../data/contact';
import { directions } from '../data/directions';
import { getTodayOpeningHours } from '../utils/openingHours';
import { getNoticeColors } from '../utils/noticeColors';

const todayInfo = getTodayOpeningHours();
const noticeColors = todayInfo.isModified ? getNoticeColors(todayInfo.noticeType) : null;
const displayHours = todayInfo.hours ?? "Zavřeno";
const hoursClass = todayInfo.isModified
  ? noticeColors?.text ?? "text-gray-800"
  : todayInfo.isClosed
    ? "text-red-600"
    : "text-gray-800";

// Google Maps URL pro adresu
const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(contactInfo.address.full)}`;
---

<Layout
  title="Kontakt - Zdravíčko"
  description="Kontaktujte naší dětskou ordinaci - telefon, email, adresa, mapa a kontaktní formulář"
>
  <Header activePage="kontakt" />
  <MobileMenu activePage="kontakt" />

  <main>
    <div class="relative">
      <PageHeader
        title="Kontakt"
        description="Jsme tu pro Vás a Vaše děti"
        gradient={true}
      />
      <StaticDragonfly right={10} top={12} size="160px" sizeMobile="110px" opacity={0.9} rotation={14} zIndex={5} />
      <StaticDragonfly left={6} bottom={8} size="150px" sizeMobile="105px" opacity={0.85} rotation={-10} zIndex={5} />
    </div>

    <!-- Contact Info & Form -->
    <section class="py-16 bg-white">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <div class="grid lg:grid-cols-2 gap-12">
            <!-- Left: Contact Information -->
            <div>
              <h2 class="text-3xl font-bold text-gray-900 mb-8">Kontaktní údaje</h2>

              <div class="space-y-4">
                <!-- Address - clickable, opens Google Maps -->
                <ContactInfoItem
                  icon="mdi:map-marker"
                  title="Adresa ordinace"
                  href={mapsUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <p class="text-gray-800 font-medium text-base">{contactInfo.address.street}</p>
                  <p class="text-gray-700 text-base">{contactInfo.address.zip} {contactInfo.address.city}</p>
                </ContactInfoItem>

                <!-- Phone - special component with multiple clickable numbers -->
                <ContactPhoneItem
                  icon="mdi:phone"
                  title="Telefon"
                  phones={[contactInfo.phones.doctor, contactInfo.phones.nurse]}
                />

                <!-- Email - clickable -->
                <ContactInfoItem
                  icon="mdi:email"
                  title="Email"
                  href={`mailto:${contactInfo.email}`}
                >
                  <p class="text-primary hover:text-primary-600 font-medium text-base">{contactInfo.email}</p>
                </ContactInfoItem>

                <!-- IČO a IČZ -->
                <ContactInfoItem
                  icon="mdi:file-document-outline"
                  title="IČO a IČZ"
                >
                  <p class="text-gray-800 font-medium text-base">IČO: 71249117</p>
                  <p class="text-gray-700 text-base">IČZ: 92354000</p>
                </ContactInfoItem>

                <!-- Opening Hours Summary - clickable, goes to full schedule -->
                <ContactInfoItem
                  icon="mdi:clock-outline"
                  title={todayInfo.title}
                  href="/ordinacni-hodiny"
                  dataOpeningTitle={true}
                >
                  <p
                    class:list={[
                      "font-medium text-base",
                      hoursClass
                    ]}
                    data-opening-hours
                    data-opening-node="contact-hours"
                    data-opening-default-classes="text-gray-800"
                  >
                    {displayHours}
                  </p>
                  <p class="text-primary text-sm font-medium inline-flex items-center gap-1 mt-2 hover:text-primary-600">
                    Celý rozvrh
                    <Icon name="mdi:arrow-right" class="w-4 h-4" />
                  </p>
                </ContactInfoItem>
              </div>

              <!-- Toxicology Center -->
              <EmergencyNotice variant="toxicology" />

              <!-- After-hours Care Notice -->
              <EmergencyNotice variant="afterhours" />

              <!-- Emergency Notice -->
              <EmergencyNotice variant="emergency" />
            </div>

            <!-- Right: Contact Form -->
            <div>
              <ContactForm />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Map Section -->
    <section class="py-16 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Jak se k nám dostanete</h2>

          <div class="bg-white rounded-2xl overflow-hidden shadow-lg border-2 border-gray-200">
            <!-- Google Maps Embed -->
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2596.8144234567!2d17.4507!3d49.4555!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4713050f9b9b9b9b%3A0x1234567890abcdef!2sSvisle%20785%2F2%2C%20750%2002%20P%C5%99erov!5e0!3m2!1scs!2scz!4v1234567890123!5m2!1scs!2scz"
              width="100%"
              height="450"
              style="border:0;"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa ordinace MUDr. Jany Šlechtové - Svisle 2/785, Přerov"
            ></iframe>
          </div>

          <!-- Directions -->
          <div class="mt-8 grid md:grid-cols-3 gap-6">
            {directions.map(direction => (
              <DirectionCard {...direction} />
            ))}
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>
