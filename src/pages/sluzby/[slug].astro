---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/common/Header.astro';
import MobileMenu from '../../components/common/MobileMenu.astro';
import Footer from '../../components/common/Footer.astro';
import CTAButtons from '../../components/common/CTAButtons.astro';
import { colorClasses } from '../../utils/colors';
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';
import type { ServiceColor } from '../../data/services';

// Import bloků
import TextBlock from '../../components/blocks/TextBlock.astro';
import FeaturesListBlock from '../../components/blocks/FeaturesListBlock.astro';
import TipBoxBlock from '../../components/blocks/TipBoxBlock.astro';
import WarningBoxBlock from '../../components/blocks/WarningBoxBlock.astro';
import FAQBlock from '../../components/blocks/FAQBlock.astro';
import StepsBlock from '../../components/blocks/StepsBlock.astro';
import CTABoxBlock from '../../components/blocks/CTABoxBlock.astro';
import ImageBlock from '../../components/blocks/ImageBlock.astro';

export async function getStaticPaths() {
  const services = await getCollection('services', ({ data }) => {
    return data.published !== false;
  });

  return services.map((service) => ({
    params: { slug: service.slug },
    props: { service },
  }));
}

const { service } = Astro.props;
const colors = colorClasses[service.data.color as ServiceColor];

// Načíst ostatní služby pro doporučené služby
const allServices = await getCollection('services', ({ data }) => {
  return data.published !== false && data.order !== undefined;
});
const otherServices = allServices
  .filter(s => s.id !== service.id)
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999))
  .slice(0, 3);
---

<Layout
  title={`${service.data.title} - Zdravíčko`}
  description={service.data.excerpt}
>
  <Header activePage="sluzby" />
  <MobileMenu activePage="sluzby" />

  <main>
    <!-- Hero Section -->
    <section class={`pt-4 pb-8 md:pt-8 md:pb-14 bg-linear-to-br ${colors.gradient}`}>
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <a
            href="/sluzby"
            class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-8 md:mb-10 font-medium"
          >
            <Icon name="mdi:arrow-left" class="w-5 h-5" />
            Zpět na všechny služby
          </a>

          <div class="flex items-start gap-3 md:gap-6 mb-5 md:mb-8">
            <div class={`w-14 h-14 md:w-20 md:h-20 ${colors.bg} rounded-2xl flex items-center justify-center shrink-0`}>
              <Icon name={service.data.icon} class="w-7 h-7 md:w-10 md:h-10 text-white" />
            </div>
            <div class="flex-1">
              <h1 class="text-2xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-2 md:mb-4">
                {service.data.title}
              </h1>
              <p class="text-sm md:text-xl text-gray-600">
                {service.data.excerpt}
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Content Section -->
    <section class="py-10 md:py-16 bg-white">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">

          <!-- Modulární bloky obsahu -->
          {service.data.content_blocks && service.data.content_blocks.map((block: any) => {
            switch (block.type) {
              case 'text':
                return <TextBlock content={block.content} />;

              case 'features_list':
                return <FeaturesListBlock
                  heading={block.heading}
                  items={block.items}
                  color={service.data.color}
                />;

              case 'tip_box':
                return <TipBoxBlock
                  heading={block.heading}
                  content={block.content}
                  icon={block.icon}
                  color={service.data.color}
                />;

              case 'warning_box':
                return <WarningBoxBlock content={block.content} />;

              case 'faq':
                return <FAQBlock
                  heading={block.heading}
                  items={block.items}
                />;

              case 'steps':
                return <StepsBlock
                  heading={block.heading}
                  steps={block.steps}
                  color={service.data.color}
                />;

              case 'cta_box':
                return <CTABoxBlock
                  heading={block.heading}
                  description={block.description}
                  buttonText={block.buttonText}
                  buttonLink={block.buttonLink}
                  color={service.data.color}
                />;

              case 'image':
                return <ImageBlock
                  src={block.src}
                  alt={block.alt}
                  caption={block.caption}
                />;

              default:
                return null;
            }
          })}
        </div>
      </div>
    </section>

    <!-- Other Services -->
    <section class="py-20 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">
            Další naše služby
          </h2>
          <div class="grid md:grid-cols-3 gap-4">
            {otherServices.map((otherService) => {
                const otherColors = colorClasses[otherService.data.color as ServiceColor];
                return (
                  <a
                    href={`/sluzby/${otherService.slug}`}
                    class="bg-white p-6 rounded-xl border-2 border-gray-100 hover:border-gray-300 hover:shadow-md transition-all"
                  >
                    <div class={`w-12 h-12 ${otherColors.bg} rounded-lg flex items-center justify-center mb-4`}>
                      <Icon name={otherService.data.icon} class="w-6 h-6 text-white" />
                    </div>
                    <h3 class="font-bold text-gray-900 mb-2">
                      {otherService.data.title}
                    </h3>
                    <p class="text-sm text-gray-600">
                      {otherService.data.excerpt}
                    </p>
                  </a>
                );
              })}
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>
