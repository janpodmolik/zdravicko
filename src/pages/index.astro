---
import Layout from '../layouts/Layout.astro';
import Header from '../components/common/Header.astro';
import MobileMenu from '../components/common/MobileMenu.astro';
import HeroWithDragonflies from '../components/home/HeroWithDragonflies.astro';
import QuickInfo from '../components/home/QuickInfo.astro';
import SpecialNotice from '../components/home/SpecialNotice.astro';
import About from '../components/home/About.astro';
import HorizontalCarousel from '../components/common/HorizontalCarousel.astro';
import ServiceCard from '../components/cards/ServiceCardCarousel.astro';
import BlogCard from '../components/cards/BlogCard.astro';
import NewsCard from '../components/cards/NewsCard.astro';
import OpeningHours from '../components/home/OpeningHours.astro';
import Contact from '../components/home/Contact.astro';
import Footer from '../components/common/Footer.astro';
import StaticDragonfly from '../components/decorations/StaticDragonfly.astro';

import { getTodayOpeningHours } from '../utils/openingHours';
import { getPublishedNews, getPublishedBlogPosts } from '../utils/contentHelpers';
import { getCollection } from 'astro:content';
import type { ServiceColor } from '../data/services';

const todayInfo = getTodayOpeningHours();
const latestNews = (await getPublishedNews()).slice(0, 3);
const latestBlogPosts = (await getPublishedBlogPosts()).slice(0, 3);

// Načíst služby pro homepage
const allServices = await getCollection('services', ({ data }) => {
  return data.published !== false && data.showOnHomepage === true;
});
const homepageServices = allServices
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999))
  .map(service => ({
    id: service.id,
    title: service.data.title,
    slug: service.slug,
    excerpt: service.data.excerpt,
    description: service.data.excerpt,
    icon: service.data.icon,
    color: service.data.color as ServiceColor,
    showOnHomepage: service.data.showOnHomepage,
  }));
---

<Layout title="Zdravíčko - Dětská ordinace | Kvalitní péče o vaše děti">
  <Header activePage="home" />
  <MobileMenu activePage="home" />

  <HeroWithDragonflies />
  <QuickInfo todayInfo={todayInfo} />

  <SpecialNotice />

  <!-- Aktuality Carousel s vážkami -->
  <div class="relative">
    <StaticDragonfly left={5} top={8} size="112px" sizeMobile="80px" opacity={0.15} rotation={-5} />
    <StaticDragonfly right={10} top={20} size="96px" sizeMobile="64px" opacity={0.12} rotation={8} />
    {latestNews.length > 0 && (
      <HorizontalCarousel
        id="aktuality"
        title="Aktuality"
        description="Aktuální informace z naší ordinace"
        ctaText="Všechny aktuality"
        ctaLink="/aktuality"
        bgColor="gray"
      >
        {latestNews.map(news => (
          <NewsCard news={news} />
        ))}
      </HorizontalCarousel>
    )}
  </div>

  <!-- Služby Carousel s vážkami -->
  <div class="relative">
    <StaticDragonfly left={8} bottom={12} size="104px" sizeMobile="72px" opacity={0.18} rotation={-10} />
    <StaticDragonfly right={5} bottom={10} size="128px" sizeMobile="88px" opacity={0.2} rotation={-15} />
    <HorizontalCarousel
      id="sluzby"
      title="Naše služby"
      description="Poskytujeme kompletní péči pro vaše děti"
      ctaText="Všechny služby"
      ctaLink="/sluzby"
      bgColor="white"
    >
      {homepageServices.map(service => (
        <ServiceCard
          icon={service.icon}
          title={service.title}
          description={service.excerpt}
          href={`/sluzby/${service.slug}`}
          color={service.color}
        />
      ))}
    </HorizontalCarousel>
  </div>

  <!-- Blog Carousel s vážkami -->
  <div class="relative">
    <StaticDragonfly left={6} top={16} size="88px" sizeMobile="64px" opacity={0.13} rotation={-8} />
    <StaticDragonfly right={8} top={12} size="96px" sizeMobile="72px" opacity={0.15} rotation={10} />
    {latestBlogPosts.length > 0 && (
      <HorizontalCarousel
        id="blog"
        title="Z našeho blogu"
        description="Užitečné rady a informace pro rodiče"
        ctaText="Všechny články"
        ctaLink="/blog"
        bgColor="gray"
      >
        {latestBlogPosts.map(post => (
          <BlogCard post={post} variant="carousel" />
        ))}
      </HorizontalCarousel>
    )}
  </div>

  <!-- About sekce s vážkami -->
  <div class="relative">
    <StaticDragonfly left={4} bottom={8} size="120px" sizeMobile="80px" opacity={0.2} rotation={-15} />
    <StaticDragonfly right={12} top={16} size="104px" sizeMobile="72px" opacity={0.16} rotation={12} />
    <About />
  </div>

  <!-- Ordinační hodiny s vážkami -->
  <div class="relative">
    <StaticDragonfly left={10} top={18} size="92px" sizeMobile="68px" opacity={0.14} rotation={-12} />
    <StaticDragonfly right={6} top={12} size="112px" sizeMobile="80px" opacity={0.15} rotation={20} />
    <OpeningHours />
  </div>

  <!-- Kontakt s vážkami -->
  <div class="relative">
    <StaticDragonfly left={8} bottom={16} size="96px" sizeMobile="72px" opacity={0.2} rotation={-10} />
    <StaticDragonfly right={15} bottom={20} size="108px" sizeMobile="76px" opacity={0.18} rotation={15} />
    <Contact />
  </div>

  <Footer />
</Layout>
