---
import { Icon } from 'astro-icon/components';
import { contactInfo } from '../../data/contact';
import { navItems, type PageId } from '../../data/navigation';

interface Props {
  activePage?: PageId;
}

const { activePage = 'home' } = Astro.props;

const colorStyles = {
  blue: {
    active: 'text-blue-600 bg-blue-50 font-semibold',
    inactive: 'text-gray-700 hover:text-blue-600 hover:bg-blue-50'
  },
  pink: {
    active: 'text-pink-600 bg-pink-50 font-semibold',
    inactive: 'text-pink-600 hover:text-pink-700 hover:bg-pink-50'
  }
} as const;
---

<div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-50 hidden md:hidden transition-opacity" aria-hidden="true"></div>

<div id="mobile-menu" class="fixed top-0 right-0 h-full w-80 max-w-[85vw] bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out md:hidden">
  <div class="flex flex-col h-full">
    <div class="flex items-center justify-between p-6 border-b border-gray-200">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 bg-linear-to-br from-blue-500 to-cyan-400 rounded-lg flex items-center justify-center">
          <span class="text-white text-lg font-bold">Z</span>
        </div>
        <span class="text-xl font-bold text-gray-900">Zdravíčko</span>
      </div>
      <button id="mobile-menu-close" class="text-gray-600 hover:text-blue-600 p-2" aria-label="Zavřít menu">
        <Icon name="mdi:close" class="w-6 h-6" />
      </button>
    </div>

    <nav class="flex-1 overflow-y-auto p-6">
      <div class="flex flex-col gap-2">
        {navItems.map(item => {
          const color = item.color || 'blue';
          const isActive = item.page === activePage;
          const styles = colorStyles[color];

          return (
            <a
              href={item.href}
              class:list={[
                'transition-colors py-3 px-4 rounded-lg font-medium',
                isActive ? styles.active : styles.inactive
              ]}
            >
              {item.label}
            </a>
          );
        })}
      </div>
    </nav>

    <div class="p-6 border-t border-gray-200">
      <a href={`tel:${contactInfo.phones.doctor.number}`} class="block bg-blue-600 text-white px-6 py-4 rounded-lg hover:bg-blue-700 transition-colors text-center font-semibold">
        <Icon name="mdi:phone" class="w-5 h-5 inline-block mr-2" />
        Zavolat
      </a>
    </div>
  </div>
</div>

<script is:inline>
  (function() {
    function initMobileMenu() {
      const menuButton = document.getElementById('mobile-menu-button');
      const menuClose = document.getElementById('mobile-menu-close');
      const menu = document.getElementById('mobile-menu');
      const overlay = document.getElementById('mobile-menu-overlay');

      if (!menuButton || !menuClose || !menu || !overlay) return;

      // Otevření menu s animací
      menuButton.onclick = function() {
        overlay.classList.remove('hidden');
        setTimeout(function() {
          overlay.classList.add('opacity-100');
          menu.classList.remove('translate-x-full');
        }, 10);
        document.body.style.overflow = 'hidden';
      };

      // Zavření s animací (close button a overlay)
      function closeMenuAnimated() {
        menu.classList.add('translate-x-full');
        overlay.classList.remove('opacity-100');
        document.body.style.overflow = '';
        setTimeout(function() {
          overlay.classList.add('hidden');
        }, 300);
      }

      // OKAMŽITÉ zmizení bez animace (navigační linky)
      function hideMenuInstantly() {
        menu.style.transition = 'none';
        overlay.style.transition = 'none';
        menu.classList.add('translate-x-full');
        overlay.classList.add('hidden');
        overlay.classList.remove('opacity-100');
        document.body.style.overflow = '';
        // Obnovit transition pro příště
        setTimeout(function() {
          menu.style.transition = '';
          overlay.style.transition = '';
        }, 50);
      }

      menuClose.onclick = closeMenuAnimated;
      overlay.onclick = closeMenuAnimated;

      // Všechny linky zavřou menu OKAMŽITĚ
      var links = menu.querySelectorAll('a');
      for (var i = 0; i < links.length; i++) {
        links[i].onclick = hideMenuInstantly;
      }
    }

    // Inicializace při každém načtení stránky
    initMobileMenu();

    // Re-inicializace po navigaci (pro případné SPA routing)
    document.addEventListener('astro:page-load', initMobileMenu);
    document.addEventListener('DOMContentLoaded', initMobileMenu);
  })();
</script>
