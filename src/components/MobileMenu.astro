---
import { Icon } from 'astro-icon/components';
import { contactInfo } from '../data/contact';

interface Props {
  activePage?: 'home' | 'cenik' | 'blog' | 'sluzby' | 'o-nas' | 'aktuality' | 'ordinacni-hodiny' | 'kontakt';
}

const { activePage = 'home' } = Astro.props;

const navItems = [
  { href: '/', label: 'Domů', page: 'home' },
  { href: '/o-nas', label: 'O nás', page: 'o-nas' },
  { href: '/aktuality', label: 'Aktuality', page: 'aktuality' },
  { href: '/sluzby', label: 'Služby', page: 'sluzby' },
  { href: '/ordinacni-hodiny', label: 'Ordinační hodiny', page: 'ordinacni-hodiny' },
  { href: '/cenik', label: 'Ceník', page: 'cenik' },
  { href: '/blog', label: 'Blog', page: 'blog' },
  { href: '/kontakt', label: 'Kontakt', page: 'kontakt' }
];
---

<div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-50 hidden md:hidden transition-opacity" aria-hidden="true"></div>

<div id="mobile-menu" class="fixed top-0 right-0 h-full w-80 max-w-[85vw] bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out md:hidden">
  <div class="flex flex-col h-full">
    <div class="flex items-center justify-between p-6 border-b border-gray-200">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 bg-linear-to-br from-blue-500 to-cyan-400 rounded-lg flex items-center justify-center">
          <span class="text-white text-lg font-bold">Z</span>
        </div>
        <span class="text-xl font-bold text-gray-900">Zdravíčko</span>
      </div>
      <button id="mobile-menu-close" class="text-gray-600 hover:text-blue-600 p-2" aria-label="Zavřít menu">
        <Icon name="mdi:close" class="w-6 h-6" />
      </button>
    </div>
    
    <nav class="flex-1 overflow-y-auto p-6">
      <div class="flex flex-col gap-2">
        {navItems.map(item => (
          <a 
            href={item.href} 
            class:list={[
              'transition-colors py-3 px-4 rounded-lg font-medium',
              item.page === activePage 
                ? 'text-blue-600 bg-blue-50 font-semibold' 
                : 'text-gray-700 hover:text-blue-600 hover:bg-blue-50'
            ]}
          >
            {item.label}
          </a>
        ))}
      </div>
    </nav>
    
    <div class="p-6 border-t border-gray-200">
      <a href={`tel:${contactInfo.phones.doctor.number}`} class="block bg-blue-600 text-white px-6 py-4 rounded-lg hover:bg-blue-700 transition-colors text-center font-semibold">
        <Icon name="mdi:phone" class="w-5 h-5 inline-block mr-2" />
        Zavolat
      </a>
    </div>
  </div>
</div>

<script is:inline>
  (function() {
    function initMobileMenu() {
      const menuButton = document.getElementById('mobile-menu-button');
      const menuClose = document.getElementById('mobile-menu-close');
      const menu = document.getElementById('mobile-menu');
      const overlay = document.getElementById('mobile-menu-overlay');
      
      if (!menuButton || !menuClose || !menu || !overlay) return;
      
      menuButton.onclick = function() {
        overlay.classList.remove('hidden');
        setTimeout(function() {
          overlay.classList.add('opacity-100');
          menu.classList.remove('translate-x-full');
        }, 10);
        document.body.style.overflow = 'hidden';
      };
      
      function closeMenu() {
        menu.classList.add('translate-x-full');
        overlay.classList.remove('opacity-100');
        document.body.style.overflow = '';
        setTimeout(function() {
          overlay.classList.add('hidden');
        }, 300);
      }
      
      menuClose.onclick = closeMenu;
      overlay.onclick = closeMenu;
      
      menu.querySelectorAll('a').forEach(function(link) {
        link.addEventListener('click', closeMenu);
      });
    }
    
    // Initial load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileMenu);
    } else {
      initMobileMenu();
    }
    
    // Re-initialize after Astro view transitions
    document.addEventListener('astro:page-load', initMobileMenu);
  })();
</script>
