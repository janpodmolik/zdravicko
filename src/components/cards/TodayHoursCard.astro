---
/**
 * TodayHoursCard - Karta zobrazující dnešní ordinační hodiny
 *
 * Zobrazuje aktuální den a otevírací hodiny s případným speciálním oznámením.
 * Barvy se mění podle typu oznámení (warning, urgent, info).
 *
 * DŮLEŽITÉ: Výchozí styl je vždy "normal" (modrá). Client-side script aplikuje
 * warning styling pouze pokud platí special notice DNES.
 */
import { Icon } from 'astro-icon/components';
import SpecialNotice from '../home/SpecialNotice.astro';
import { getTodayActualHours, getSpecialNoticeDisplay } from '../../utils/openingHours';

// getTodayActualHours ignoruje showEarly flag (zobrazí warning jen když platí DNES)
const todayInfo = getTodayActualHours();

// Zkontroluj jestli je early warning (showEarly=true a datum ještě neplatí)
const specialNoticeDisplay = getSpecialNoticeDisplay(true);
const showEarlyWarning = specialNoticeDisplay.shouldDisplay && specialNoticeDisplay.isEarlyWarning;

// Výchozí styly - vždy "normal" (modrá)
const todayCardDefault = "rounded-2xl shadow-lg p-8 border-2 bg-white border-[#5085c6]/30";
const todayIconDefault = "w-12 h-12 rounded-full flex items-center justify-center relative bg-[#5085c6]";
const todayHoursDefault = "text-3xl font-bold mb-2 text-primary";
const displayHours = todayInfo.hours ?? "Zavřeno";
---

<div
  class="rounded-2xl shadow-lg p-8 border-2 bg-white border-[#5085c6]/30"
  data-opening-today-card
  data-opening-node="today-card"
  data-opening-default-classes={todayCardDefault}
>
  <div class="flex items-center gap-4 mb-4">
    <div
      class="w-12 h-12 rounded-full flex items-center justify-center relative bg-[#5085c6]"
      data-opening-node="today-icon"
      data-opening-default-classes={todayIconDefault}
    >
      <Icon
        name="mdi:clock-outline"
        class="w-6 h-6 text-white"
        aria-hidden="true"
        data-opening-icon="default"
      />
      <Icon
        name="mdi:alert-circle-outline"
        class="w-6 h-6 text-white hidden"
        aria-hidden="true"
        data-opening-icon="modified"
      />
    </div>
    <div>
      <h2
        class="text-2xl font-bold text-gray-900"
        data-opening-title
      >
        {todayInfo.title}
      </h2>
      <p
        class="text-gray-600"
        data-opening-date
      >
        {new Date().toLocaleDateString('cs-CZ', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
      </p>
    </div>
  </div>

  <!-- Hodiny (pokud existují) -->
  {(todayInfo.hours || todayInfo.isClosed) && (
    <div
      class="text-3xl font-bold mb-2 text-primary"
      data-opening-hours
      data-opening-node="today-hours"
      data-opening-default-classes={todayHoursDefault}
    >
      {displayHours}
    </div>
  )}

  <!-- Zpráva/oznámení (skrytá defaultně, zobrazí se scriptem) -->
  <div
    class="mt-4 p-4 border-l-4 rounded hidden"
    data-opening-node="today-notice"
    data-opening-default-classes="hidden"
  >
    <p
      class="text-sm font-medium text-[#5085c6]"
      data-opening-node="today-notice-text"
      data-opening-default-classes="text-[#5085c6]"
    >
      <Icon name="mdi:information" class="w-4 h-4 inline mr-1" aria-hidden="true" />
      <span data-opening-notice-text>{todayInfo.notice ?? ''}</span>
    </p>
  </div>
</div>

<!-- Special Notice komponenta (zobrazí se JEN pokud je early warning - showEarly=true a datum ještě neplatí) -->
{showEarlyWarning && (
  <div class="mt-6">
    <SpecialNotice />
  </div>
)}
